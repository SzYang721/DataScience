% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Assignment 2 STAT7050},
  pdfauthor={Songze Yang, u7192786},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Assignment 2 STAT7050}
\author{Songze Yang, u7192786}
\date{2022-09-16}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\# Package Loading}

\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(mgcv)}
\FunctionTok{library}\NormalTok{(npreg)}
\FunctionTok{library}\NormalTok{(np)}
\FunctionTok{library}\NormalTok{(data.table)}

\NormalTok{ksmooth.gcv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y)\{}
\NormalTok{  nobs }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(y)}
\NormalTok{  xs }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(x, }\AttributeTok{index.return =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}}\NormalTok{ xs}\SpecialCharTok{$}\NormalTok{x}
\NormalTok{  y }\OtherTok{\textless{}{-}}\NormalTok{ y[xs}\SpecialCharTok{$}\NormalTok{ix]}
\NormalTok{  xdif }\OtherTok{\textless{}{-}} \FunctionTok{outer}\NormalTok{(x, x, }\AttributeTok{FUN =} \StringTok{"{-}"}\NormalTok{)}
\NormalTok{  tune.ksmooth }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(h)\{}
\NormalTok{    xden }\OtherTok{\textless{}{-}} \FunctionTok{dnorm}\NormalTok{(xdif }\SpecialCharTok{/}\NormalTok{ h)}
\NormalTok{    xden }\OtherTok{\textless{}{-}}\NormalTok{ xden }\SpecialCharTok{/} \FunctionTok{rowSums}\NormalTok{(xden)}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(}\FunctionTok{diag}\NormalTok{(xden))}
\NormalTok{    fit }\OtherTok{\textless{}{-}}\NormalTok{ xden }\SpecialCharTok{\%*\%}\NormalTok{ y}
    \FunctionTok{mean}\NormalTok{((fit }\SpecialCharTok{{-}}\NormalTok{ y)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ df}\SpecialCharTok{/}\NormalTok{nobs)}\SpecialCharTok{\^{}}\DecValTok{2}
\NormalTok{  \}}
\NormalTok{  xrng }\OtherTok{\textless{}{-}} \FunctionTok{diff}\NormalTok{(}\FunctionTok{range}\NormalTok{(x))}
\NormalTok{  oh }\OtherTok{\textless{}{-}} \FunctionTok{optimize}\NormalTok{(tune.ksmooth, }\AttributeTok{interval =} \FunctionTok{c}\NormalTok{(xrng}\SpecialCharTok{/}\NormalTok{nobs, xrng))}\SpecialCharTok{$}\NormalTok{minimum}
  \ControlFlowTok{if}\NormalTok{(}\FunctionTok{any}\NormalTok{(oh }\SpecialCharTok{==} \FunctionTok{c}\NormalTok{(xrng}\SpecialCharTok{/}\NormalTok{nobs, xrng)))}
    \FunctionTok{warning}\NormalTok{(}\StringTok{"Minimum found on boundary of search range.}\SpecialCharTok{\textbackslash{}n}\StringTok{You should retune model with expanded range."}\NormalTok{)}
\NormalTok{  xden }\OtherTok{\textless{}{-}} \FunctionTok{dnorm}\NormalTok{(xdif }\SpecialCharTok{/}\NormalTok{ oh)}
\NormalTok{  xden }\OtherTok{\textless{}{-}}\NormalTok{ xden }\SpecialCharTok{/} \FunctionTok{rowSums}\NormalTok{(xden)}
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(}\FunctionTok{diag}\NormalTok{(xden))}
\NormalTok{  fit }\OtherTok{\textless{}{-}}\NormalTok{ xden }\SpecialCharTok{\%*\%}\NormalTok{ y}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ fit, }\AttributeTok{df =}\NormalTok{ df, }\AttributeTok{h =}\NormalTok{ oh)}
\NormalTok{\}}

\DocumentationTok{\#\#\#\#\# Data Loading}

\FunctionTok{getwd}\NormalTok{()}
\FunctionTok{setwd}\NormalTok{(}\StringTok{"E:/ANU Sem 3/STAT3050STAT4050STAT7050 {-} Advanced Statistical Learning {-} Sem 2 2022/A2"}\NormalTok{)}
\NormalTok{HE}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"HE.csv"}\NormalTok{)}
\NormalTok{GHE}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"GHE.csv"}\NormalTok{)}
\NormalTok{GDP}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"GDP.csv"}\NormalTok{)}
\NormalTok{DR\_young}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"DR\_young.csv"}\NormalTok{)}
\NormalTok{DR\_old}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"DR\_old.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The study between health-care expenditure and income can be conducted
using the health-care expenditure (HE), income (GDP), the proportions of
population aged below 14 and above 65 over all population
(DR\textsubscript{young} and \textsubscript{DR\_old}) and the proportion
of government fundings invested on health care industry (GHE). The data
of 18 OECD country is contained in 5 different data set.

\hypertarget{question-1}{%
\subsection{Question 1}\label{question-1}}

We consider the non-parameter regression model. The model takes 4
input,namely GDP, GHE, DR\textsubscript{young} and DR\textsubscript{old}
and return the predicted value for the health-care expenditure (HE).

\[
y^{(i)}_t = g_i(x^{(i)}_{1t}*,x^{(i)}_{2t}, x^{(i)}_{3t}, x^{(i)}_{4t})+ Îµ^{(i)}_t, t = 1, 2, . . . , T.
\]

The principal component analysis is used here to reduce dimension of our
input. The method to choose the number of principal component score is
the difference of eigenvalues: \[max_i (\lambda_i-\lambda_{i+1})\].
Under this criterion, we just keep the number of PCs after which the
largest gap \[(\lambda_r-\lambda_{r+1})\] appears.

As the PCA is scaled, all the corresponding value is also scales, for
instance, the \textsubscript{y\_i}. This makes the each response and its
predicted value to be on the same scale and the MSE makes more sense.

Then we can apply kernel smoothing and smoothing spline method to get
the prediction. Notice that the ksmooth() function will not make
prediction on the test data easy to implement. Therefore, a npreg() is
performed to estimate a kernel smoothing spline using Gaussian kernel
and to make prediction on the test data. To reduce the uncertainty in
extrapolation, the local line fit is considered here.

The result is shown below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{country}\OtherTok{\textless{}{-}}\FunctionTok{t}\NormalTok{(HE[,}\DecValTok{1}\NormalTok{])}
\NormalTok{countrylist}\OtherTok{\textless{}{-}}\FunctionTok{list}\NormalTok{()}
\NormalTok{model\_ss}\OtherTok{\textless{}{-}}\FunctionTok{list}\NormalTok{()}
\NormalTok{model\_kernel}\OtherTok{\textless{}{-}}\FunctionTok{list}\NormalTok{()}
\NormalTok{MSE\_train\_ks}\OtherTok{\textless{}{-}}\ConstantTok{NULL}
\NormalTok{MSE\_test\_ks}\OtherTok{\textless{}{-}}\ConstantTok{NULL}
\NormalTok{MSE\_train\_ss}\OtherTok{\textless{}{-}}\ConstantTok{NULL}
\NormalTok{MSE\_test\_ss}\OtherTok{\textless{}{-}}\ConstantTok{NULL}
\NormalTok{fit\_value\_ks}\OtherTok{\textless{}{-}}\ConstantTok{NULL}
\NormalTok{fit\_value\_ss}\OtherTok{\textless{}{-}}\ConstantTok{NULL}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(country))\{}
  \DocumentationTok{\#\#\# Get data of each country}
\NormalTok{  country\_data }\OtherTok{\textless{}{-}}\FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{t}\NormalTok{(}\FunctionTok{rbind}\NormalTok{(HE[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{],GHE[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{],GDP[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{],DR\_young[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{],DR\_old[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{])))}
  \FunctionTok{colnames}\NormalTok{(country\_data)}\OtherTok{\textless{}{-}}\FunctionTok{c}\NormalTok{(}\StringTok{"HE"}\NormalTok{,}\StringTok{"GHE"}\NormalTok{,}\StringTok{"GDP"}\NormalTok{,}\StringTok{"DR\_young"}\NormalTok{,}\StringTok{"DR\_old"}\NormalTok{)}
\NormalTok{  countrylist[[i]]}\OtherTok{\textless{}{-}}\NormalTok{country\_data}
  \DocumentationTok{\#\#\#}
  
  \DocumentationTok{\#\#\# apply the dimension reduction method}
\NormalTok{  PCA\_train }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{prcomp}\NormalTok{(country\_data[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{30}\NormalTok{,}\DecValTok{2}\SpecialCharTok{:}\DecValTok{5}\NormalTok{], }\AttributeTok{scale. =} \ConstantTok{TRUE}\NormalTok{)}\SpecialCharTok{$}\NormalTok{x)}
\NormalTok{  PCA\_test }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{prcomp}\NormalTok{(country\_data[}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{30}\NormalTok{),}\DecValTok{2}\SpecialCharTok{:}\DecValTok{5}\NormalTok{], }\AttributeTok{scale. =} \ConstantTok{TRUE}\NormalTok{)}\SpecialCharTok{$}\NormalTok{x)}
\NormalTok{  y\_train}\OtherTok{\textless{}{-}}\FunctionTok{scale}\NormalTok{(country\_data}\SpecialCharTok{$}\NormalTok{HE)[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{30}\NormalTok{]}
\NormalTok{  y\_test}\OtherTok{\textless{}{-}}\FunctionTok{scale}\NormalTok{(country\_data}\SpecialCharTok{$}\NormalTok{HE)[}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{30}\NormalTok{)]}
\NormalTok{  mod\_data}\OtherTok{\textless{}{-}}\FunctionTok{cbind}\NormalTok{(y\_train,PCA\_train)}
  \DocumentationTok{\#\#\#}
  
  \DocumentationTok{\#\#\# Kernel smoothing method}
  \DocumentationTok{\#\# ksmooth.gcv, ksmooth() is used but cannot make prediction out of it. npreg() provides this functionality.}
  \CommentTok{\# Just for prediction}
\NormalTok{  bw }\OtherTok{\textless{}{-}} \FunctionTok{npregbw}\NormalTok{(y\_train}\SpecialCharTok{\textasciitilde{}}\NormalTok{PC1,}\AttributeTok{data =}\NormalTok{ mod\_data)}
\NormalTok{  mod\_kernel}\OtherTok{\textless{}{-}}\FunctionTok{npreg}\NormalTok{(bw,}\AttributeTok{data =}\NormalTok{ mod\_data)}
\NormalTok{  model\_kernel[[i]]}\OtherTok{\textless{}{-}}\NormalTok{mod\_kernel}
  \DocumentationTok{\#\#\#}
  
  \DocumentationTok{\#\#\# Smoothing spline method}
\NormalTok{  mod\_ss}\OtherTok{\textless{}{-}}\FunctionTok{ss}\NormalTok{(PCA\_train}\SpecialCharTok{$}\NormalTok{PC1,y\_train, }\AttributeTok{all.knots =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{method =} \StringTok{"GCV"}\NormalTok{)}
\NormalTok{  model\_ss[[i]]}\OtherTok{\textless{}{-}}\NormalTok{mod\_ss}
  \DocumentationTok{\#\#\#}
  
  \DocumentationTok{\#\#\# Calculate the train and test MSE for kernel smoothing method}
\NormalTok{  MSE\_train\_ks}\OtherTok{\textless{}{-}}\FunctionTok{rbind}\NormalTok{(MSE\_train\_ks,mod\_kernel}\SpecialCharTok{$}\NormalTok{MSE)}
\NormalTok{  pred}\OtherTok{\textless{}{-}}\FunctionTok{predict}\NormalTok{(mod\_kernel,}\AttributeTok{newdata =}\NormalTok{ PCA\_test)}
\NormalTok{  fit\_value\_ks}\OtherTok{\textless{}{-}}\FunctionTok{rbind}\NormalTok{(fit\_value\_ks,}\FunctionTok{cbind}\NormalTok{(}\FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{t}\NormalTok{(}\FunctionTok{fitted}\NormalTok{(mod\_kernel))),}\FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{t}\NormalTok{(pred))))}
\NormalTok{  MSE\_test\_ks}\OtherTok{\textless{}{-}}\FunctionTok{rbind}\NormalTok{(MSE\_test\_ks,}\FunctionTok{mean}\NormalTok{((pred}\SpecialCharTok{{-}}\NormalTok{ y\_test)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
  \DocumentationTok{\#\#\#}
  
  \DocumentationTok{\#\#\# Calculate the train and test MSE for Smoothing spline method}
\NormalTok{  MSE\_train\_ss}\OtherTok{\textless{}{-}}\FunctionTok{rbind}\NormalTok{(MSE\_train\_ss,}\FunctionTok{mean}\NormalTok{((mod\_ss}\SpecialCharTok{$}\NormalTok{y }\SpecialCharTok{{-}}\NormalTok{ y\_train)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\NormalTok{  pred}\OtherTok{\textless{}{-}}\FunctionTok{predict.ss}\NormalTok{(mod\_ss,}\AttributeTok{x =}\NormalTok{ PCA\_test}\SpecialCharTok{$}\NormalTok{PC1)}
\NormalTok{  fit\_value\_ss}\OtherTok{\textless{}{-}}\FunctionTok{rbind}\NormalTok{(fit\_value\_ss,}\FunctionTok{cbind}\NormalTok{(}\FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{t}\NormalTok{(mod\_ss}\SpecialCharTok{$}\NormalTok{y)),}\FunctionTok{t}\NormalTok{(pred}\SpecialCharTok{$}\NormalTok{y)))}
\NormalTok{  MSE\_test\_ss}\OtherTok{\textless{}{-}}\FunctionTok{rbind}\NormalTok{(MSE\_test\_ss,}\FunctionTok{mean}\NormalTok{((pred}\SpecialCharTok{$}\NormalTok{y }\SpecialCharTok{{-}}\NormalTok{ y\_test)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
  \DocumentationTok{\#\#\#}
  
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(fit\_value\_ks)}\OtherTok{\textless{}{-}}\FunctionTok{colnames}\NormalTok{(HE[,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{])}
\FunctionTok{rownames}\NormalTok{(fit\_value\_ks)}\OtherTok{\textless{}{-}}\NormalTok{country}
\NormalTok{fit\_value\_ks}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                     1971       1972       1973       1974       1975       1976
## Australia      -1.412639 -1.3936842 -1.3171060 -1.2541614 -0.9069229 -0.9545851
## Austria        -1.486288 -1.4745916 -1.4381407 -1.3339254 -1.0795731 -1.0012343
## Canada         -1.458534 -1.4202853 -1.3313789 -1.3320696 -1.3300382 -1.2750086
## Denmark        -1.418729 -1.3163804 -1.1613856 -1.2015829 -1.1600456 -1.1542716
## Finland        -1.459277 -1.3723648 -1.3346441 -1.3049778 -1.1977641 -1.1289231
## Germany        -1.867941 -1.7225186 -1.5081494 -1.2973110 -1.0884773 -0.9265333
## Iceland        -1.554725 -1.5364098 -1.5529757 -1.4037978 -1.3207399 -1.3374944
## Ireland        -0.941079 -0.9351276 -0.9421206 -0.9199582 -0.9517337 -0.9089349
## Japan          -1.516445 -1.4439979 -1.3847343 -1.1769800 -1.2481963 -1.0252630
## Korea          -1.007494 -1.0162803 -1.0051563 -0.9904912 -0.9657482 -0.9534207
## Netherlands    -1.296754 -1.2328418 -1.1689188 -1.0852839 -1.0215084 -0.9823626
## New Zealand    -1.290543 -1.1461050 -0.9756459 -0.8305663 -0.8612320 -0.7814334
## Norway         -1.304988 -1.3770415 -1.3007894 -1.2385808 -1.1931944 -1.1344833
## Portugal       -1.469576 -1.3782585 -1.2176159 -1.1893509 -1.2039359 -1.0843054
## Spain          -1.417929 -1.3339403 -1.3452271 -1.1578267 -1.1818637 -1.0138788
## Sweden         -1.423784 -1.3161039 -1.1621212 -1.1815889 -1.0881891 -1.0142052
## United Kingdom -1.285882 -1.1984616 -1.0693888 -1.1067131 -1.1181535 -1.0501503
## United States  -1.330109 -1.3066394 -1.2852679 -1.2559124 -1.2118191 -1.1812531
##                      1977       1978       1979       1980       1981
## Australia      -1.0526378 -0.9555171 -0.9298761 -0.8855382 -0.8841320
## Austria        -0.9061120 -0.8753989 -0.8314874 -0.7588456 -0.9789313
## Canada         -1.1817072 -1.1132229 -1.0151890 -0.9351473 -0.8321719
## Denmark        -1.0112982 -0.9420816 -0.9088589 -0.8365822 -0.8006400
## Finland        -1.0825248 -1.0511562 -0.9935038 -0.9368721 -0.8883103
## Germany        -0.7987751 -0.6585934 -0.5650154 -0.5148755 -0.5503946
## Iceland        -1.2605699 -1.1044517 -0.8741614 -0.9200321 -0.7862884
## Ireland        -0.8311736 -0.7752027 -0.7587806 -0.7104594 -0.7009572
## Japan          -1.1252984 -0.8211910 -0.8468716 -0.9831244 -0.9342514
## Korea          -0.9149719 -0.8940171 -0.8493533 -0.8227128 -0.8122072
## Netherlands    -0.9440951 -0.8930152 -0.8360040 -0.7872289 -0.7803006
## New Zealand    -0.7960885 -0.7682500 -0.8051427 -0.8305919 -0.8503194
## Norway         -1.0789866 -0.9217701 -0.9058530 -0.8935782 -0.8563641
## Portugal       -1.0178777 -1.0219261 -0.8937875 -0.8911736 -0.8237944
## Spain          -0.9820488 -0.9915777 -0.9705664 -0.9343654 -0.9040064
## Sweden         -1.0012330 -0.8906885 -0.7641339 -0.6939709 -0.6232975
## United Kingdom -0.9847270 -0.9465065 -0.8979431 -0.8627551 -0.8296340
## United States  -1.1469106 -1.0655674 -0.9910280 -0.9176053 -0.8615069
##                      1982       1983       1984       1985       1986
## Australia      -0.9165199 -0.8263632 -0.7387417 -0.6657588 -0.6180767
## Austria        -0.9594368 -0.9336481 -0.7393587 -0.3546416 -0.2327943
## Canada         -0.9226264 -0.8317329 -0.6598263 -0.5339909 -0.4449179
## Denmark        -0.7484126 -0.7103273 -0.6785720 -0.6213521 -0.4844349
## Finland        -0.8216708 -0.7516660 -0.6798833 -0.5732996 -0.4694556
## Germany        -0.7065624 -0.9009137 -0.8405967 -0.7496630 -0.6056001
## Iceland        -0.7256138 -0.7477046 -0.6940358 -0.5947527 -0.3619116
## Ireland        -0.6886740 -0.6813452 -0.6722526 -0.6656750 -0.6599671
## Japan          -0.8433029 -0.6508581 -0.5673656 -0.5740319 -0.4594357
## Korea          -0.7789939 -0.7495308 -0.7208931 -0.6899613 -0.6749005
## Netherlands    -0.7637323 -0.7351384 -0.7582613 -0.7274207 -0.6692239
## New Zealand    -0.8500219 -0.8394999 -0.7978705 -0.7427609 -0.5910609
## Norway         -0.8086538 -0.7633846 -0.7272196 -0.6804299 -0.6337218
## Portugal       -0.9381759 -0.9819008 -0.9862393 -0.8395654 -0.7208397
## Spain          -0.8749383 -0.8815875 -0.8621173 -0.8564993 -0.8295486
## Sweden         -0.5600455 -0.5082994 -0.4619656 -0.4129437 -0.3641786
## United Kingdom -0.7693798 -0.7551192 -0.7337923 -0.6820450 -0.6398501
## United States  -0.8786662 -0.8015707 -0.7449036 -0.6981801 -0.5346951
##                       1987        1988        1989        1990        1991
## Australia      -0.47795938 -0.47330380 -0.41553547 -0.48436367 -0.44598343
## Austria        -0.40748828 -0.57723982 -0.79099676 -0.34276361 -0.18045873
## Canada         -0.35099107 -0.20846497 -0.11483124 -0.06728733 -0.11606952
## Denmark        -0.41194491 -0.39640906 -0.29431170 -0.12338714 -0.17260967
## Finland        -0.34510877 -0.19248470 -0.08656417 -0.08421468 -0.09307644
## Germany        -0.53324417 -0.50060584 -0.63536644 -0.55068840 -0.44970200
## Iceland        -0.08146863 -0.08425994 -0.10307459 -0.17291086 -0.18243773
## Ireland        -0.64097447 -0.63905478 -0.65812536 -0.60958291 -0.54385859
## Japan          -0.39451300 -0.34825701 -0.31349834 -0.25718988 -0.16909675
## Korea          -0.62686192 -0.55405630 -0.50729975 -0.40099085 -0.38171652
## Netherlands    -0.61964586 -0.59033267 -0.47704676 -0.36669592 -0.27634738
## New Zealand    -0.68170518 -0.56450125 -0.48426325 -0.46738357 -0.62560175
## Norway         -0.61069925 -0.49993007 -0.42119386  0.03844595 -0.01130746
## Portugal       -0.59329503 -0.45777623 -0.47434521 -0.42048062 -0.23364167
## Spain          -0.73693386 -0.53170685 -0.40228613 -0.25516057 -0.12764491
## Sweden         -0.31015773 -0.26913492 -0.25001854 -0.12030665 -0.14143677
## United Kingdom -0.55626192 -0.47999864 -0.36317838 -0.33900608 -0.27970991
## United States  -0.42071880 -0.47313135 -0.40277704 -0.35449369 -0.22689200
##                       1992        1993         1994        1995        1996
## Australia      -0.33976979 -0.23134623 -0.139826716 -0.02064935  0.04604658
## Austria         0.04172393 -0.01958751  0.174697178 -0.13609786 -0.19207765
## Canada         -0.03088512  0.06033327  0.063637615  0.03256988  0.03423417
## Denmark        -0.13497736 -0.12101514 -0.075921008 -0.09307197 -0.09832740
## Finland        -0.12002271 -0.13448482 -0.084807133 -0.07083385 -0.01839895
## Germany        -0.06891777 -0.05751248  0.045822354  0.24507820  0.38253128
## Iceland        -0.16446669 -0.17925814 -0.171093902 -0.14540613 -0.03778438
## Ireland        -0.47849726 -0.43523364 -0.387830715 -0.32660636 -0.27104378
## Japan          -0.11710530 -0.03153356 -0.007730356  0.10100690  0.16568372
## Korea          -0.34788792 -0.30087818 -0.242457843 -0.18662479 -0.11157060
## Netherlands    -0.21290299 -0.16503763 -0.145206643 -0.11495983 -0.06878916
## New Zealand    -0.60390410 -0.40950963 -0.235823807 -0.11908289 -0.05789687
## Norway         -0.02609120 -0.03804905 -0.024773316  0.02354927  0.07430415
## Portugal       -0.20452344 -0.12984357 -0.060118138  0.12026799  0.28369791
## Spain          -0.03122802  0.02297801  0.069033280  0.16092555  0.21465961
## Sweden         -0.32894072 -0.38325166 -0.382672939 -0.36049455 -0.35279373
## United Kingdom -0.28720857 -0.28463536 -0.146152617 -0.11148743 -0.07194069
## United States  -0.07409379  0.04283400  0.199402521  0.26037372  0.29504794
##                       1997        1998        1999       2000        2001
## Australia       0.21312941  0.34654909  0.53136730  0.5152282 -1.37033680
## Austria         0.15695548  0.41008476  0.63648936  0.7785892  0.98815738
## Canada          0.13004426  0.18068542  0.31376876  0.4002267  0.21305322
## Denmark        -0.08826701 -0.06858214 -0.18369515 -0.1429066 -0.09388674
## Finland         0.03000361  0.06388562  0.14844521  0.2976827 -1.42231909
## Germany         0.30875681  0.31108676  0.55762521  0.4654950 -1.57442586
## Iceland         0.03968239  0.43254566  0.61646631  0.7823738 -0.03852905
## Ireland        -0.18543169 -0.12604631  0.00429716  0.1951700 -0.67228789
## Japan           0.19043261  0.20205364  0.27695122  0.4851386 -1.45412339
## Korea          -0.04557560  0.00204941  0.09564938  0.2229031 -1.04120288
## Netherlands    -0.04319354  0.07145163  0.17746414  0.2218195  0.08751169
## New Zealand     0.02048888  0.04961865  0.24846252  0.3381497 -1.44341962
## Norway          0.36118755  0.23076964  0.08093251  0.0114516  0.57992996
## Portugal        0.36131282  0.46379426  0.60195817  0.9172212 -1.15769795
## Spain           0.26174569  0.33962414  0.43383835  0.5194661 -0.39464365
## Sweden         -0.30178385 -0.24862835 -0.19386903 -0.1270568 -0.04163591
## United Kingdom -0.06068440  0.06154075  0.12748887  0.3304416 -1.35879127
## United States   0.31410390  0.24766492  0.24303171  0.2740072 -1.26662096
##                      2002        2003        2004       2005       2006
## Australia      -1.1322144 -0.96188242 -0.88713469 -0.8133520 -0.7605616
## Austria         0.9037572  0.86790350  0.66706348 -0.7447330 -0.9584993
## Canada          0.2355962  0.06999496  0.03592235 -0.2552476 -0.3320418
## Denmark        -0.2427809 -0.26394202 -0.10296547 -0.3646806 -0.5929601
## Finland        -1.3421572 -1.07528641 -0.96397030 -0.8235667 -0.6110429
## Germany        -1.4968022 -1.39521051 -1.20668920 -1.0294894 -0.6617150
## Iceland        -0.1624400 -0.18237124 -0.21188128 -0.6495103 -1.1245151
## Ireland        -0.5670326 -0.51054977 -0.45088571 -0.4074205 -0.3596589
## Japan          -1.3635782 -1.20024484 -0.70692147 -0.4384140 -0.4202193
## Korea          -0.9868012 -0.95612487 -0.86576834 -0.7884936 -0.6290821
## Netherlands     0.1082274  0.06174168 -0.04662650 -0.1325270 -0.7262251
## New Zealand    -1.0762918 -0.78756995 -0.81243123 -0.8487883 -0.8206100
## Norway          0.4252289  0.06828676 -0.28296162 -0.5141323 -0.6704121
## Portugal       -1.2396267 -1.07713038 -1.06373677 -1.0334534 -0.5939564
## Spain          -0.4950868 -0.69893865 -0.84962665 -0.8865332 -1.0167458
## Sweden         -0.1346607 -0.25753195 -0.33163553 -0.3811791 -0.4760604
## United Kingdom -1.0943101 -0.96717328 -0.79413871 -0.6738505 -0.4466183
## United States  -1.2517729 -1.22349050 -1.12756395 -0.9925789 -0.7450731
##                      2007        2008        2009       2010         2011
## Australia      -0.7312012 -0.68366627 -0.53028411 -0.3209360  0.001195853
## Austria        -0.9829862 -0.72751055 -0.85237022 -0.7345625 -0.814041025
## Canada         -0.5447039 -0.66129185 -0.73085800 -0.8286549 -1.244985493
## Denmark        -0.6137808 -0.70850266 -0.79068250 -0.7406766 -0.760869175
## Finland        -0.1082300 -0.07218323 -0.36002800 -0.1801760 -0.020343448
## Germany        -0.3836981 -0.25503993 -0.06089448  0.1397752  0.154261832
## Iceland        -1.3708167 -1.51503220 -1.16778237 -0.3761445 -0.046453987
## Ireland        -0.2678116 -0.31408278 -0.45971589 -0.6620706 -0.889688552
## Japan          -0.3428399 -0.35533676 -0.44427050 -0.2428844  0.022113967
## Korea          -0.5233459 -0.57654101 -0.35795638 -0.2393995 -0.216251392
## Netherlands    -0.7895880 -0.88892035 -0.82996214 -0.9185523 -0.991576031
## New Zealand    -0.3054887 -0.64581379 -0.48034689 -0.3811911 -0.194966693
## Norway         -0.7641154 -0.82446215 -0.82443893 -0.8815252 -0.895293084
## Portugal       -0.4935233 -0.47100056 -0.47377745 -0.4510590 -0.031774980
## Spain          -1.2695086 -1.16280085 -0.85249768 -0.5610612 -0.124544648
## Sweden         -0.5511680 -0.56824440 -0.51688091 -0.6207946 -1.066127507
## United Kingdom -0.2730866 -0.18943678 -0.47864625 -0.4733373 -0.473694541
## United States  -0.5916403 -0.38673388 -0.35863789 -0.1253641  0.029847664
##                       2012         2013
## Australia       0.12973873  0.309914464
## Austria        -0.93106446 -0.940542691
## Canada         -1.36046762 -1.464863793
## Denmark        -1.05917005 -1.614040368
## Finland         0.01106627 -0.006168685
## Germany         0.21604276  0.331720985
## Iceland        -0.18224350 -0.090689237
## Ireland        -0.60501654  1.166745661
## Japan           0.07979963  0.224535450
## Korea          -0.19972445 -0.111911470
## Netherlands    -1.00882702 -1.107176433
## New Zealand     0.02579881  0.189770831
## Norway         -1.07486002 -1.212638206
## Portugal        0.51651257  0.552704395
## Spain           0.23409021  0.532891393
## Sweden         -0.95555999 -1.284202470
## United Kingdom -0.45525799 -0.694190587
## United States   0.28817310  0.521580124
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(fit\_value\_ss)}\OtherTok{\textless{}{-}}\FunctionTok{colnames}\NormalTok{(HE[,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{])}
\FunctionTok{rownames}\NormalTok{(fit\_value\_ss)}\OtherTok{\textless{}{-}}\NormalTok{country}
\NormalTok{fit\_value\_ss}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                       1971         1972        1973        1974        1975
## Australia      -1.39937873 -1.380521099 -1.30465089 -1.23963283 -1.03123956
## Austria        -1.48552321 -1.474931485 -1.43541055 -1.29346882 -1.06953207
## Canada          0.39299343  0.301232088  0.16966852  0.12915068  0.05767876
## Denmark        -0.08674606 -0.101824699 -0.11982574 -0.12554537 -0.13127690
## Finland        -1.45512541 -1.392913904 -1.32833983 -1.26887065 -1.19886161
## Germany        -1.94281270 -1.722238470 -1.44600609 -1.21182614 -1.01969404
## Iceland         0.78496056  0.581839541  0.43290822  0.12150506 -0.05496075
## Ireland         0.17599821  0.009595046 -0.12964915 -0.19511096 -0.26976764
## Japan          -1.54949912 -1.462640188 -1.39622429 -1.23783714 -1.15960643
## Korea          -1.00517117 -1.004485106 -1.00694305 -1.01372977 -0.96404966
## Netherlands     0.22329107  0.175007641  0.07063489 -0.03876521 -0.07225619
## New Zealand    -1.24672086 -1.097174614 -0.94814214 -0.85912271 -0.83570460
## Norway          0.24884817  0.164572856  0.05714087  0.05202148  0.02369606
## Portugal       -1.41793444 -1.360167675 -1.25041094 -1.23835733 -1.19578702
## Spain           0.52144240  0.428399508  0.34241619  0.26544001  0.21063240
## Sweden         -0.13445083 -0.140961913 -0.15467402 -0.20346362 -0.25458437
## United Kingdom -1.20457693 -1.171336864 -1.13233333 -1.12445673 -1.08882820
## United States  -1.33702349 -1.321793488 -1.30453530 -1.27930171 -1.23909131
##                       1976         1977        1978        1979        1980
## Australia      -0.95095014 -0.950059315 -0.92420360 -0.91073700 -0.90240619
## Austria        -0.99773905 -0.907145759 -0.88551622 -0.85732232 -0.80686926
## Canada          0.05223120  0.060468110  0.05134814 -0.05508929 -0.08369128
## Denmark        -0.15198961 -0.153893004 -0.16270397 -0.16834193 -0.18748488
## Finland        -1.15126201 -1.107416118 -1.06525873 -1.00456495 -0.93827492
## Germany        -0.89110553 -0.871642143 -0.82616792 -0.79463420 -0.75719694
## Iceland        -0.15777477 -0.168611697 -0.16003449 -0.15604215 -0.15125741
## Ireland        -0.32785324 -0.381073419 -0.43518592 -0.48538332 -0.55219161
## Japan          -1.10843864 -1.015580851 -0.97671033 -0.93116879 -0.84791557
## Korea          -0.94721254 -0.939041495 -0.91005607 -0.83682793 -0.81608882
## Netherlands    -0.11398706 -0.138530168 -0.17135438 -0.21414283 -0.27158242
## New Zealand    -0.80733113 -0.792731896 -0.76654149 -0.78324466 -0.82231467
## Norway          0.01160972  0.001652172 -0.01743381 -0.02894186 -0.03007668
## Portugal       -1.08756956 -1.004626164 -1.00173993 -0.97836676 -0.97482176
## Spain           0.16249105  0.082927260  0.01559335 -0.03543126 -0.11662429
## Sweden         -0.25588453 -0.273725723 -0.30394747 -0.31167036 -0.32898550
## United Kingdom -1.06981755 -1.007500220 -0.95683446 -0.88677246 -0.85761515
## United States  -1.21119478 -1.179582575 -1.10028131 -1.02144277 -0.94212055
##                       1981       1982       1983       1984       1985
## Australia      -0.88675147 -0.8858426 -0.8539892 -0.7217172 -0.6496800
## Austria        -0.99791152 -1.0726300 -0.9193766 -0.7399766 -0.6543335
## Canada         -0.11762085 -0.1184939 -0.1881699 -0.3284426 -0.4344403
## Denmark        -0.19404575 -0.2514571 -0.3018498 -0.3100375 -0.3535865
## Finland        -0.87702542 -0.7948172 -0.7165370 -0.6493158 -0.5537143
## Germany        -0.72361635 -0.6849693 -0.6656126 -0.6400503 -0.6035993
## Iceland        -0.14964101 -0.1480431 -0.1506054 -0.1511259 -0.3348795
## Ireland        -0.61302661 -0.6390798 -0.6408339 -0.6578290 -0.6599230
## Japan          -0.84445537 -0.8229175 -0.6560481 -0.5814868 -0.5748750
## Korea          -0.79291908 -0.7741137 -0.7480629 -0.7349054 -0.7056622
## Netherlands    -0.36149518 -0.4813081 -0.5857314 -0.6238384 -0.6678195
## New Zealand    -0.86685024 -0.8670634 -0.8625394 -0.8223715 -0.7586557
## Norway         -0.04044315 -0.4307273 -0.5142509 -0.6280971 -0.6538670
## Portugal       -0.93005477 -0.8781040 -0.8754540 -0.8332199 -0.8228640
## Spain          -0.25555522 -0.3923728 -0.5571410 -0.7254384 -0.8254925
## Sweden         -0.35113230 -0.3583662 -0.3618429 -0.3794545 -0.3800106
## United Kingdom -0.83219539 -0.7842863 -0.7741300 -0.7576827 -0.6596019
## United States  -0.90044524 -0.8822218 -0.8192465 -0.7605658 -0.7126056
##                      1986       1987       1988       1989       1990
## Australia      -0.6079935 -0.4869359 -0.4809654 -0.4766130 -0.4508795
## Austria        -0.4455532 -0.3105208 -0.2763138 -0.2689191 -0.2039441
## Canada         -0.5375911 -0.6764776 -0.8469694 -0.8473273 -0.9149424
## Denmark        -0.4845216 -0.5734767 -0.6827991 -0.7929760 -0.8741947
## Finland        -0.4513096 -0.3300410 -0.2131109 -0.1729655 -0.1611921
## Germany        -0.5902409 -0.5899641 -0.5736071 -0.5556434 -0.5413683
## Iceland        -0.5716481 -0.6714041 -0.7497445 -0.7692492 -0.7868453
## Ireland        -0.6667256 -0.6725663 -0.6772268 -0.6863411 -0.7000490
## Japan          -0.4568948 -0.3861743 -0.3384560 -0.2973712 -0.2391409
## Korea          -0.6832194 -0.6476283 -0.5762677 -0.4638280 -0.4166048
## Netherlands    -0.7286054 -0.7529096 -0.7410178 -0.7639604 -0.7781067
## New Zealand    -0.6907502 -0.6337964 -0.6128485 -0.6006181 -0.5754789
## Norway         -0.7103577 -0.7571509 -0.7864212 -0.8223765 -0.8627686
## Portugal       -0.7592884 -0.6376676 -0.5001230 -0.4567541 -0.3196042
## Spain          -0.8495856 -0.8534571 -0.8727558 -0.8798257 -0.9022535
## Sweden         -0.4088922 -0.4557108 -0.4951754 -0.5358919 -0.5893974
## United Kingdom -0.5937847 -0.4942986 -0.4081067 -0.3256792 -0.3143046
## United States  -0.5445527 -0.4798914 -0.4240828 -0.4048411 -0.3529136
##                      1991        1992        1993        1994        1995
## Australia      -0.4218599 -0.34804583 -0.23938101 -0.14549699 -0.02135329
## Austria        -0.1809313 -0.17442148 -0.14970009 -0.08441400 -0.04877363
## Canada         -0.9240448 -0.99116627 -1.11623456 -1.19907207 -1.28567893
## Denmark        -0.9167656 -0.98640431 -1.01371341 -1.06499820 -1.15520560
## Finland        -0.1298970 -0.11239546 -0.09643607 -0.08032538 -0.04595527
## Germany        -0.4882571 -0.05916274 -0.04662032  0.06572116  0.27228989
## Iceland        -0.8438493 -0.95615814 -1.07430183 -1.23742477 -1.32200657
## Ireland        -0.7092952 -0.75458884 -0.77068265 -0.82795634 -0.90684831
## Japan          -0.1669814 -0.13068967 -0.06536333 -0.04118568  0.10574301
## Korea          -0.3864284 -0.32455818 -0.29858140 -0.26391793 -0.19158174
## Netherlands    -0.7909675 -0.83618575 -0.89241681 -0.94443830 -0.98009803
## New Zealand    -0.4988035 -0.48231167 -0.42471935 -0.24653886 -0.12638384
## Norway         -0.8960594 -0.90714618 -0.92156533 -1.07658274 -1.13472626
## Portugal       -0.2421230 -0.22112583 -0.11773633 -0.04065638  0.07859229
## Spain          -0.9326299 -0.96811223 -0.97889146 -0.98768670 -1.00789508
## Sweden         -0.6588693 -0.73411396 -0.87109314 -0.98683192 -1.00006680
## United Kingdom -0.2915848 -0.29047938 -0.28836401 -0.22614565 -0.20627194
## United States  -0.2169592 -0.06106527  0.05348262  0.20549903  0.24829669
##                        1996        1997        1998       1999       2000
## Australia       0.048259135  0.21760270  0.34993175  0.5121234  0.5274655
## Austria         0.023835968  0.03599344  0.24868746  0.5887051  0.8786195
## Canada         -1.328552136 -1.32965527 -1.33022555 -1.4199892 -1.4660456
## Denmark        -1.158455713 -1.15920570 -1.18096243 -1.2363230 -1.2802076
## Finland        -0.001101122  0.05584854  0.11053113  0.1695674  0.2561284
## Germany         0.334089043  0.33630693  0.40290826  0.4772648  0.5571934
## Iceland        -1.371743276 -1.42403404 -1.49061278 -1.5415674 -1.5678951
## Ireland        -0.918519495 -0.93514203 -0.94190988 -0.9431191 -0.9550770
## Japan           0.184630490  0.20525470  0.21411829  0.2646493  0.3907163
## Korea          -0.080205716 -0.03567756 -0.06212411  0.1065187  0.2219143
## Netherlands    -1.027896292 -1.08082996 -1.16761512 -1.2357701 -1.2951988
## New Zealand    -0.063571484  0.01695270  0.04685881  0.2545388  0.3540546
## Norway         -1.190963265 -1.23139477 -1.28613639 -1.2899027 -1.3592045
## Portugal        0.243080574  0.35566080  0.50229792  0.6273058  0.8777292
## Spain          -1.144939380 -1.17053261 -1.33637409 -1.3481001 -1.4139888
## Sweden         -1.073867001 -1.14441586 -1.16244885 -1.2821050 -1.3738487
## United Kingdom -0.178093339  0.08594179  0.11903813  0.1361042  0.1912586
## United States   0.252850050  0.26534681  0.27877390  0.2995640  0.3185314
##                       2001       2002        2003        2004       2005
## Australia      -1.35747615 -1.1079866 -0.95685426 -0.88779960 -0.8454520
## Austria         2.06465065  1.5595553  1.28897454  0.64272162 -0.6630919
## Canada          0.19785052  0.2190941  0.06332866  0.01668957 -0.2294696
## Denmark        -0.12646651 -0.2259173 -0.23655004 -0.13597406 -0.2857724
## Finland        -1.42894511 -1.3434658 -1.09832201 -0.97183501 -0.7971182
## Germany        -1.52705242 -1.4324612 -1.31571613 -1.12380042 -0.9714039
## Iceland        -0.05617212 -0.1670527 -0.15659110 -0.20671833 -0.6259701
## Ireland        -0.67258498 -0.5745211 -0.51875281 -0.45476041 -0.4009429
## Japan          -1.47431265 -1.3725862 -1.18403500 -0.71049843 -0.4329767
## Korea          -0.91994541 -1.0095215 -0.94964421 -0.85755614 -0.7746190
## Netherlands     0.08851250  0.1109368  0.05983971 -0.04589143 -0.1298095
## New Zealand    -1.49284764 -1.0332550 -0.79923620 -0.79305283 -0.8567733
## Norway          0.38284397  0.2885128  0.04734282 -0.28034251 -0.5288983
## Portugal       -1.15611473 -1.2667702 -1.07590667 -1.04724542 -1.0131416
## Spain          -0.38446623 -0.5129957 -0.69379470 -0.84438189 -0.8848615
## Sweden         -0.05109172 -0.1482395 -0.26290706 -0.33147402 -0.3780206
## United Kingdom -1.23231108 -1.1143529 -0.98683847 -0.80334843 -0.6434970
## United States  -1.28877532 -1.2755697 -1.24974795 -1.16142732 -1.0231162
##                      2006       2007        2008        2009       2010
## Australia      -0.8063048 -0.7117088 -0.66538971 -0.52925679 -0.3294124
## Austria        -1.0740298 -0.9328469 -0.82313179 -0.84802731 -0.8079738
## Canada         -0.3077167 -0.5498300 -0.67807931 -0.75273177 -0.8444484
## Denmark        -0.4518213 -0.4754599 -0.67523090 -0.86104517 -0.7765767
## Finland        -0.5882666 -0.1499957 -0.04768716 -0.34376154 -0.2049370
## Germany        -0.6875355 -0.4152612 -0.26796270 -0.05033668  0.1652645
## Iceland        -1.0850375 -1.4037246 -1.47252912 -1.14894486 -0.3495525
## Ireland        -0.3564485 -0.2668083 -0.31542224 -0.46497299 -0.6623991
## Japan          -0.4130797 -0.3322505 -0.34620147 -0.43954806 -0.2260208
## Korea          -0.6486368 -0.4996900 -0.61306357 -0.34050956 -0.2608026
## Netherlands    -0.7270745 -0.7956963 -0.88848990 -0.82993457 -0.9198959
## New Zealand    -0.8462607 -0.3184754 -0.65378878 -0.49499044 -0.3960653
## Norway         -0.6984255 -0.7869949 -0.83539810 -0.83537872 -0.8852000
## Portugal       -0.6385054 -0.5290439 -0.46116240 -0.45748571 -0.4214321
## Spain          -1.0104656 -1.2661115 -1.15018869 -0.84675145 -0.5840014
## Sweden         -0.4682868 -0.5288772 -0.54244362 -0.50200556 -0.5871259
## United Kingdom -0.3773250 -0.2855182 -0.24804004 -0.40673724 -0.4014494
## United States  -0.7607403 -0.6034866 -0.38759915 -0.35737125 -0.1124324
##                        2011        2012        2013
## Australia       0.001513056  0.13390471  0.31390013
## Austria        -0.841947224 -0.92836110 -0.93715475
## Canada         -1.261557484 -1.35524235 -1.47373973
## Denmark        -0.815977923 -1.09730521 -1.35892398
## Finland        -0.002718041  0.02907350  0.01004399
## Germany         0.180311901  0.24335485  0.35581833
## Iceland        -0.164174180 -0.15535335 -0.14955079
## Ireland        -0.887059872 -1.23548565 -2.56273595
## Japan          -0.006938247  0.07078619  0.23024967
## Korea          -0.233289227 -0.21059323 -0.08068595
## Netherlands    -0.988134648 -1.00991102 -1.10441136
## New Zealand    -0.204405244  0.02240605  0.19188573
## Norway         -0.897606999 -1.07218784 -1.20848217
## Portugal       -0.019949290  0.55581555  0.58734169
## Spain          -0.113615069  0.23276383  0.53641213
## Sweden         -1.052181674 -0.93963481 -1.25437640
## United Kingdom -0.401800587 -0.38463956 -0.68457481
## United States   0.040872867  0.29275768  0.54852822
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_MSE}\OtherTok{\textless{}{-}}\FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(MSE\_train\_ks,MSE\_test\_ks,MSE\_train\_ss,MSE\_test\_ss))}
\FunctionTok{colnames}\NormalTok{(df\_MSE)}\OtherTok{\textless{}{-}}\FunctionTok{c}\NormalTok{(}\StringTok{"Train MSE Kernel smoothing"}\NormalTok{,}\StringTok{"Test MSE Kernel smoothing"}\NormalTok{,}\StringTok{"Train MSE Smoothing spline"}\NormalTok{,}\StringTok{"Test MSE Smoothing spline"}\NormalTok{)}
\FunctionTok{rownames}\NormalTok{(df\_MSE)}\OtherTok{\textless{}{-}}\NormalTok{country}
\NormalTok{df\_MSE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                Train MSE Kernel smoothing Test MSE Kernel smoothing
## Australia                    3.645469e-03                  3.660696
## Austria                      4.563183e-02                  3.463573
## Canada                       4.881485e-03                  4.063112
## Denmark                      3.244273e-02                  4.374454
## Finland                      5.369096e-03                  3.336771
## Germany                      3.499099e-02                  3.248177
## Iceland                      9.051057e-04                  3.708581
## Ireland                      8.826680e-04                  3.534070
## Japan                        8.303985e-03                  3.098477
## Korea                        4.183803e-04                  3.734592
## Netherlands                  7.175833e-06                  4.496728
## New Zealand                  1.410420e-02                  3.758174
## Norway                       3.448673e-02                  4.023777
## Portugal                     3.785316e-03                  3.572143
## Spain                        3.709780e-04                  3.782036
## Sweden                       1.863728e-02                  4.450078
## United Kingdom               4.025752e-03                  4.057061
## United States                8.047642e-03                  3.453981
##                Train MSE Smoothing spline Test MSE Smoothing spline
## Australia                    1.898403e-03                  3.659690
## Austria                      4.387042e-02                  3.695095
## Canada                       1.395100e+00                  4.088368
## Denmark                      7.893632e-01                  4.218238
## Finland                      6.472637e-03                  3.325101
## Germany                      2.300811e-02                  3.130969
## Iceland                      1.591673e+00                  3.692507
## Ireland                      3.091856e-01                  5.363271
## Japan                        4.938664e-03                  3.101420
## Korea                        1.021273e-06                  3.715369
## Netherlands                  7.136912e-01                  4.496429
## New Zealand                  1.018016e-02                  3.789453
## Norway                       1.096332e+00                  4.074026
## Portugal                     3.921205e-03                  3.564062
## Spain                        1.297337e+00                  3.773954
## Sweden                       5.326490e-01                  4.391887
## United Kingdom               7.612389e-03                  3.930363
## United States                5.322147e-03                  3.495606
\end{verbatim}

\hypertarget{question-2}{%
\subsection{Question 2}\label{question-2}}

Now, let us assume that the model for each country is homogeneous. Under
this homogeneous assumption, we can pool the data together and then get
the smoothing spline prediction.

\[
g(.) := g_1(.) = g_2(.)= ... = g_{18}(.) 
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{country}\OtherTok{\textless{}{-}}\FunctionTok{t}\NormalTok{(HE[,}\DecValTok{1}\NormalTok{])}

\NormalTok{pool\_train}\OtherTok{\textless{}{-}}\FunctionTok{data.frame}\NormalTok{(}\FunctionTok{matrix}\NormalTok{(}\AttributeTok{ncol =} \DecValTok{5}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{0}\NormalTok{))}
\NormalTok{pool\_test}\OtherTok{\textless{}{-}}\FunctionTok{data.frame}\NormalTok{(}\FunctionTok{matrix}\NormalTok{(}\AttributeTok{ncol =} \DecValTok{5}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{0}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(country))\{}
\NormalTok{  data }\OtherTok{\textless{}{-}}\NormalTok{data.table}\SpecialCharTok{::}\FunctionTok{transpose}\NormalTok{(}\FunctionTok{rbind}\NormalTok{(country[i],HE[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{],GHE[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{],GDP[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{],DR\_young[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{],DR\_old[i,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]))}
  \FunctionTok{colnames}\NormalTok{(data)}\OtherTok{\textless{}{-}}\FunctionTok{c}\NormalTok{(}\StringTok{"Country"}\NormalTok{,}\StringTok{"HE"}\NormalTok{,}\StringTok{"GHE"}\NormalTok{,}\StringTok{"GDP"}\NormalTok{,}\StringTok{"DR\_young"}\NormalTok{,}\StringTok{"DR\_old"}\NormalTok{)}
  
\NormalTok{  pool\_train}\OtherTok{\textless{}{-}}\FunctionTok{rbind}\NormalTok{(pool\_train,data[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{30}\NormalTok{,])}
\NormalTok{  pool\_test}\OtherTok{\textless{}{-}}\FunctionTok{rbind}\NormalTok{(pool\_test,data[}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{30}\NormalTok{),])}
\NormalTok{\}}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\DecValTok{6}\NormalTok{)\{}
\NormalTok{  pool\_train[,i]}\OtherTok{\textless{}{-}}\FunctionTok{as.numeric}\NormalTok{(pool\_train[,i])}
\NormalTok{  pool\_test[,i]}\OtherTok{\textless{}{-}}\FunctionTok{as.numeric}\NormalTok{(pool\_test[,i])}
\NormalTok{\}}

\NormalTok{PCA\_training}\OtherTok{\textless{}{-}}\FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{prcomp}\NormalTok{(pool\_train[,}\DecValTok{3}\SpecialCharTok{:}\DecValTok{6}\NormalTok{], }\AttributeTok{scale. =} \ConstantTok{TRUE}\NormalTok{)}\SpecialCharTok{$}\NormalTok{x)}
\NormalTok{PCA\_testing}\OtherTok{\textless{}{-}}\FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{prcomp}\NormalTok{(pool\_test[,}\DecValTok{3}\SpecialCharTok{:}\DecValTok{6}\NormalTok{], }\AttributeTok{scale. =} \ConstantTok{TRUE}\NormalTok{)}\SpecialCharTok{$}\NormalTok{x)}
\NormalTok{y\_train2}\OtherTok{\textless{}{-}}\FunctionTok{scale}\NormalTok{(pool\_train}\SpecialCharTok{$}\NormalTok{HE)}
\NormalTok{y\_test2}\OtherTok{\textless{}{-}}\FunctionTok{scale}\NormalTok{(pool\_test}\SpecialCharTok{$}\NormalTok{HE)}
\NormalTok{mod\_data2}\OtherTok{\textless{}{-}}\FunctionTok{cbind}\NormalTok{(y\_train2,PCA\_training)}
\NormalTok{mod\_ss2}\OtherTok{\textless{}{-}}\FunctionTok{ss}\NormalTok{(PCA\_training}\SpecialCharTok{$}\NormalTok{PC1,y\_train2, }\AttributeTok{all.knots =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{method =} \StringTok{"GCV"}\NormalTok{)}

\NormalTok{MSE\_train\_ss2}\OtherTok{\textless{}{-}}\FunctionTok{mean}\NormalTok{((mod\_ss2}\SpecialCharTok{$}\NormalTok{y }\SpecialCharTok{{-}}\NormalTok{ y\_train2)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{pred2}\OtherTok{\textless{}{-}}\FunctionTok{predict.ss}\NormalTok{(mod\_ss2,}\AttributeTok{x =}\NormalTok{ PCA\_testing}\SpecialCharTok{$}\NormalTok{PC1)}
\NormalTok{MSE\_test\_ss2}\OtherTok{\textless{}{-}}\FunctionTok{mean}\NormalTok{((pred2}\SpecialCharTok{$}\NormalTok{y }\SpecialCharTok{{-}}\NormalTok{ y\_test2)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{MSE\_train\_ss2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.458498
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MSE\_test\_ss2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.771958
\end{verbatim}

\hypertarget{question-3}{%
\subsection{Question 3}\label{question-3}}

The resulting MSE from Q1 and Q2 is shown below. The homogeneous model
yields much lower test MSE than the non-homogeneous model.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(MSE\_test\_ss)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3.861434
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MSE\_test\_ss2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.771958
\end{verbatim}

The averaged model (non-homogeneous model) is in the form of below. This
formulation is also known as the committee method, where each model is
assigned equal weight. There are many ways to understand this problem. I
will elaborate by three points, the sample and population analogy, the
over parameterization analogy and the model selection or cross
validation analogy.

\[
g(.) = \Sigma^{m}_1 \ w_m*g_i(.) , \ w_m = 1/m ,\  where\ m = 18
\]

Firstly, the country data we gathered is a sub sample from the pooled
data (the whole population). Writing in mathematical form:

\[
E[Y - \Sigma^{m}_1 \ w_m*g_i(.)]^2 \leq E[Y - g_M(.)]^2, \ where \ M = \ \Sigma^{M}_{i = 1} m_i
\]

The full model has g\textsubscript{M} has smaller error than any single
model (Hastie et al., 2017). Gather more information always facilitate
us when model fitting.

Second analogy is over parameterization. Let us suppose each model
g\textsubscript{i} has p parameters, then the overall model needs m
times p parameters. However, this is not true for the homogeneous model
in Q2. The homogeneous model takes only p parameters to estimate. The
more parameterization the model has makes the model more complicated.
The classical bias-variance trade-off does not support a over
parameterization as too complex model leads to higher test MSE and lower
training MSE.

This problem can also be approached from cross validation viewpoint. The
tuning method when fitting a smoothing spline is set as ``GCV'' (the
generalized cross validation). The hyperparameter to tune is bandwidth.
For each non-homogeneous model, the hyperparameter is only tuned at its
best local minimum concerning only a (n-1) sub sample in one country, n
is number of fold in cross validation. However, the homogeneous model is
tuned at the global minimum regarding to the whole population (pooled
data). Again, this is accorded to our sample-population analogy.

\hypertarget{question-4}{%
\subsection{Question 4}\label{question-4}}

Suppose function g follows a additive model.

\[
g_i(x^{(i)}_{1t}*,x^{(i)}_{2t}, x^{(i)}_{3t}, x^{(i)}_{4t}) = f_1(x^{(i)}_{1t})+ f_2(x^{(i)}_{2t})+ f_3(x^{(i)}_{3t})+f_4(x^{(i)}_{4t}) 
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{scale\_pool\_tr}\OtherTok{\textless{}{-}}\FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{scale}\NormalTok{(pool\_train[,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]))}
\NormalTok{scale\_pool\_test}\OtherTok{\textless{}{-}}\FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{scale}\NormalTok{(pool\_test[,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]))}
\NormalTok{mod\_gam\_pool}\OtherTok{=}\FunctionTok{gam}\NormalTok{(HE}\SpecialCharTok{\textasciitilde{}}\FunctionTok{s}\NormalTok{(GHE)}\SpecialCharTok{+}\FunctionTok{s}\NormalTok{(GDP)}\SpecialCharTok{+}\FunctionTok{s}\NormalTok{(DR\_old)}\SpecialCharTok{+}\FunctionTok{s}\NormalTok{(DR\_young),}\AttributeTok{data =}\NormalTok{ scale\_pool\_tr)}
\FunctionTok{summary}\NormalTok{(mod\_gam\_pool)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## HE ~ s(GHE) + s(GDP) + s(DR_old) + s(DR_young)
## 
## Parametric coefficients:
##              Estimate Std. Error t value Pr(>|t|)
## (Intercept) 8.147e-16  1.441e-02       0        1
## 
## Approximate significance of smooth terms:
##               edf Ref.df       F p-value    
## s(GHE)      8.954  8.994  23.478  <2e-16 ***
## s(GDP)      8.445  8.887 145.753  <2e-16 ***
## s(DR_old)   8.218  8.793  11.069  <2e-16 ***
## s(DR_young) 7.878  8.659   6.238  <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.888   Deviance explained = 89.5%
## GCV = 0.11982  Scale est. = 0.11216   n = 540
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred\_additive4}\OtherTok{\textless{}{-}}\FunctionTok{predict.gam}\NormalTok{(mod\_gam\_pool,}\AttributeTok{newdata =}\NormalTok{ scale\_pool\_test)}
\FunctionTok{mean}\NormalTok{((pred\_additive4 }\SpecialCharTok{{-}}\NormalTok{ scale\_pool\_test}\SpecialCharTok{$}\NormalTok{HE)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7720145
\end{verbatim}

\hypertarget{question-5}{%
\subsection{Question 5}\label{question-5}}

Suppose the function g follows a additive structure below.

\[
g_i(x^{(i)}_{1t}*,x^{(i)}_{2t}, x^{(i)}_{3t}, x^{(i)}_{4t}) = \gamma_1(x^{(i)}_{1t},x^{(i)}_{2t})+ \gamma_3(x^{(i)}_{3t})+\gamma_4(x^{(i)}_{4t}) 
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod\_gam\_pool5 }\OtherTok{\textless{}{-}} \FunctionTok{gam}\NormalTok{(HE}\SpecialCharTok{\textasciitilde{}}\FunctionTok{s}\NormalTok{(GDP,DR\_young)}\SpecialCharTok{+}\FunctionTok{s}\NormalTok{(DR\_old)}\SpecialCharTok{+}\FunctionTok{s}\NormalTok{(GHE),}\AttributeTok{data =}\NormalTok{ scale\_pool\_tr)}
\FunctionTok{summary}\NormalTok{(mod\_gam\_pool5)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## HE ~ s(GDP, DR_young) + s(DR_old) + s(GHE)
## 
## Parametric coefficients:
##               Estimate Std. Error t value Pr(>|t|)
## (Intercept) -1.500e-15  1.367e-02       0        1
## 
## Approximate significance of smooth terms:
##                    edf Ref.df      F p-value    
## s(GDP,DR_young) 26.822 28.567 78.280  <2e-16 ***
## s(DR_old)        8.429  8.868  8.581  <2e-16 ***
## s(GHE)           8.131  8.734 19.114  <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.899   Deviance explained = 90.7%
## GCV = 0.10995  Scale est. = 0.10091   n = 540
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred\_additive5}\OtherTok{\textless{}{-}}\FunctionTok{predict.gam}\NormalTok{(mod\_gam\_pool5,}\AttributeTok{newdata =}\NormalTok{ scale\_pool\_test)}
\FunctionTok{mean}\NormalTok{((pred\_additive5 }\SpecialCharTok{{-}}\NormalTok{ scale\_pool\_test}\SpecialCharTok{$}\NormalTok{HE)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6115571
\end{verbatim}

\hypertarget{question-6}{%
\subsection{Question 6}\label{question-6}}

The test MSE for question 4 model is 0.7720145, while that of the model
for question 5 is 0.6115571. The test MSE is reduced after we combine
the GDP and DR\textsubscript{young}. We can even fit a homogeneous model
in question 2 to further compare. The homogeneous model yields even
lower test MSE.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{((pred\_additive4 }\SpecialCharTok{{-}}\NormalTok{ scale\_pool\_test}\SpecialCharTok{$}\NormalTok{HE)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7720145
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{((pred\_additive5 }\SpecialCharTok{{-}}\NormalTok{ scale\_pool\_test}\SpecialCharTok{$}\NormalTok{HE)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6115571
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# homogeneous model in Q2}
\NormalTok{mod\_gam\_pool2}\OtherTok{=}\FunctionTok{gam}\NormalTok{(HE}\SpecialCharTok{\textasciitilde{}}\FunctionTok{s}\NormalTok{(GHE,GDP,DR\_old,DR\_young),}\AttributeTok{data =}\NormalTok{ scale\_pool\_tr)}
\NormalTok{pred\_additive2}\OtherTok{\textless{}{-}}\FunctionTok{predict.gam}\NormalTok{(mod\_gam\_pool2,}\AttributeTok{newdata =}\NormalTok{ scale\_pool\_test)}
\FunctionTok{mean}\NormalTok{((pred\_additive2 }\SpecialCharTok{{-}}\NormalTok{ scale\_pool\_test}\SpecialCharTok{$}\NormalTok{HE)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1890154
\end{verbatim}

The additive model uses a iterative procedure to fit. It can reach a
dimension reduction by considering each single variable and fitting a
specific function, such as smoothing spline, in the back fitting
algorithm. However, because of this dimension reduction result, the GAM
model cannot take into account the variable interaction, which commonly
exists in the real setting.

In our mgcv packages, multi-dimensional smooths are available using
penalized thin plate regression splines (isotropic) or tensor product
splines (when an isotropic smooth is inappropriate), and we can add
smooths (Wood, 2022). The multi-dimension smooths produce better result
than one-dimensional smooth by utilizing into more information. However,
the downside of multi-dimension is that it suffers more edge effect than
one-dimension. Here, we would like to get a smoother fit so that the
edge effect and extrapolation is reasonably considered as mild problem.

\hypertarget{reference}{%
\subsection{Reference}\label{reference}}

Hastie, T., Tibshirani, R., \& Friedman, J. H. (2009). The elements of
statistical learning: data mining, inference, and prediction. 2nd
ed.~New York, Springer.

Wood, S., 2022. {[}online{]} Cran.r-project.org. Available at:
\url{https://cran.r-project.org/web/packages/mgcv/mgcv.pdf\#page=267\&zoom=100,133,726}
{[}Accessed 18 September 2022{]}.

\end{document}
